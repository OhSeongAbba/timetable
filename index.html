<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026í•™ë…„ë„ êµê³¼ì „ë‹´ ì‹œê°„í‘œ ìƒì„±ê¸° (ìŠ¤ë§ˆíŠ¸ ì•Œê³ ë¦¬ì¦˜ íƒ‘ì¬)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .timetable-cell { height: 60px; font-size: 0.85rem; }
        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: bold; }
        .tab-inactive { color: #6b7280; }
        .edit-input { width: 100%; border: 1px solid #e5e7eb; padding: 4px 8px; border-radius: 4px; }
        .edit-input:focus { border-color: #2563eb; outline: none; }
        .block-grid-cell { cursor: pointer; transition: all 0.2s; }
        .block-grid-cell:hover { background-color: #fee2e2; }
        .block-grid-cell.blocked { background-color: #ef4444; color: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ì´ˆê¸° ë°ì´í„° ---
        const INITIAL_TEACHERS = [
            { id: 1, name: '', subject: '', grade: '', classes: '', hoursPerClass: '', room: '', color: 'bg-blue-100' }
        ];

        const INITIAL_GRADE_LIMITS = {
            3: [5, 6, 5, 5, 5],
            4: [5, 6, 5, 5, 5],
            5: [6, 6, 5, 6, 6],
            6: [6, 6, 5, 6, 6]
        };
        
        const DAYS = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
        const PERIODS = [1, 2, 3, 4, 5, 6];

        const COLOR_OPTIONS = [
            { value: 'bg-blue-100', label: 'íŒŒë‘' },
            { value: 'bg-green-100', label: 'ì´ˆë¡' },
            { value: 'bg-yellow-100', label: 'ë…¸ë‘' },
            { value: 'bg-purple-100', label: 'ë³´ë¼' },
            { value: 'bg-red-100', label: 'ë¹¨ê°•' },
            { value: 'bg-indigo-100', label: 'ë‚¨ìƒ‰' },
            { value: 'bg-pink-100', label: 'ë¶„í™' },
            { value: 'bg-gray-100', label: 'íšŒìƒ‰' },
            { value: 'bg-orange-100', label: 'ì£¼í™©' },
            { value: 'bg-teal-100', label: 'ì²­ë¡' },
        ];

        function App() {
            const [teachers, setTeachers] = useState(INITIAL_TEACHERS);
            const [gradeLimits, setGradeLimits] = useState(INITIAL_GRADE_LIMITS);
            const [blockedSlots, setBlockedSlots] = useState({}); 
            const [schedule, setSchedule] = useState({});
            
            const [viewMode, setViewMode] = useState('teacher'); 
            const [activeTab, setActiveTab] = useState('settings'); 
            const [activeBlockGrade, setActiveBlockGrade] = useState(6); 

            const [isGenerating, setIsGenerating] = useState(false);
            const [generationStatus, setGenerationStatus] = useState('');
            const [logMessage, setLogMessage] = useState([]);

            // --- ë°ì´í„° í•¸ë“¤ëŸ¬ ---
            const handleTeacherChange = (id, field, value) => {
                setTeachers(prev => prev.map(t => {
                    if (t.id !== id) return t;
                    let newValue = value;
                    if (field === 'grade' || field === 'hoursPerClass') {
                        if (value === '') newValue = '';
                        else newValue = parseInt(value) || 0;
                    } 
                    return { ...t, [field]: newValue };
                }));
            };

            const addTeacher = () => {
                const newId = teachers.length > 0 ? Math.max(...teachers.map(t => t.id)) + 1 : 1;
                setTeachers([...teachers, {
                    id: newId, name: '', subject: '', grade: '', classes: '', hoursPerClass: '', room: '', color: 'bg-gray-100'
                }]);
            };

            const removeTeacher = (id) => {
                if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) setTeachers(prev => prev.filter(t => t.id !== id));
            };

            const handleGradeLimitChange = (grade, dayIdx, val) => {
                setGradeLimits(prev => {
                    const newLimits = [...prev[grade]];
                    newLimits[dayIdx] = parseInt(val) || 0;
                    return { ...prev, [grade]: newLimits };
                });
            };

            const toggleBlockedSlot = (grade, dayIdx, period) => {
                const key = `${grade}-${dayIdx}-${period}`;
                setBlockedSlots(prev => {
                    const next = { ...prev };
                    if (next[key]) delete next[key];
                    else next[key] = true;
                    return next;
                });
            };

            // ==========================================
            // [í•µì‹¬] ì•Œê³ ë¦¬ì¦˜ ë¡œì§ (ìŠ¤ë§ˆíŠ¸ ìŠ¤ì½”ì–´ë§ ë°©ì‹)
            // ==========================================

            // 1. ìœ íš¨ì„± ê²€ì‚¬ (Hard Constraints)
            const isSlotValid = (slot, task, currentSchedule, checkDailyDup = true) => {
                const { day, period } = slot;
                const keyTeacher = `T-${task.teacherId}-${day}-${period}`;
                const keyClass = `C-${task.grade}-${task.classNum}-${day}-${period}`;
                const keyRoom = task.room ? `R-${task.room}-${day}-${period}` : null;

                // A. ë¦¬ì†ŒìŠ¤ ì ìœ  í™•ì¸ (êµì‚¬, í•™ê¸‰, íŠ¹ë³„ì‹¤)
                if (currentSchedule[keyTeacher]) return false;
                if (currentSchedule[keyClass]) return false;
                if (keyRoom && currentSchedule[keyRoom]) return false;

                // B. 1ì¼ 1ê³¼ëª© ì œí•œ (ê°™ì€ ë°˜ì´ ê°™ì€ ì„ ìƒë‹˜ ìˆ˜ì—…ì„ í•˜ë£¨ì— 2ë²ˆ ëª»í•˜ê²Œ í•¨)
                if (checkDailyDup) {
                    let alreadyHasClass = false;
                    for (let p of PERIODS) {
                        const checkKey = `C-${task.grade}-${task.classNum}-${day}-${p}`;
                        const existingTask = currentSchedule[checkKey];
                        if (existingTask && existingTask.teacherId === task.teacherId) {
                            alreadyHasClass = true;
                            break;
                        }
                    }
                    if (alreadyHasClass) return false;
                }

                return true;
            };

            // 2. ì ìˆ˜ ê³„ì‚° (Soft Constraints)
            const calculateSlotScore = (slot, task, currentSchedule) => {
                let score = 0;
                const { day, period } = slot;

                // [ê·œì¹™ 1] ê³µê°•(íë‹¹íë‹¹) ìµœì†Œí™”
                // í•´ë‹¹ êµì‚¬ì˜ í•´ë‹¹ ìš”ì¼ ìŠ¤ì¼€ì¤„ì„ í™•ì¸
                let teacherPeriods = [];
                for (let p of PERIODS) {
                    if (p === period) {
                        teacherPeriods.push(p);
                        continue;
                    }
                    const keyT = `T-${task.teacherId}-${day}-${p}`;
                    if (currentSchedule[keyT]) teacherPeriods.push(p);
                }
                teacherPeriods.sort((a,b) => a-b);
                
                if (teacherPeriods.length > 0) {
                    const minP = Math.min(...teacherPeriods);
                    const maxP = Math.max(...teacherPeriods);
                    const duration = maxP - minP + 1;
                    const gaps = duration - teacherPeriods.length;
                    
                    // ê³µê°•(gap)ì´ ìƒê¸¸ìˆ˜ë¡ í° ê°ì  (-50ì )
                    score -= (gaps * 50);

                    // ì—°ì† ìˆ˜ì—…(ë¶™ì—¬ì„œ ìˆ˜ì—…)ì´ë©´ ê°€ì‚°ì  (+10ì )
                    // í˜„ì¬ ë°°ì¹˜í•˜ë ¤ëŠ” êµì‹œê°€ ê¸°ì¡´ êµì‹œë“¤ê³¼ ë¶™ì–´ìˆëŠ”ì§€ í™•ì¸
                    const isAdjacent = teacherPeriods.some(p => Math.abs(p - period) === 1);
                    if (isAdjacent) score += 10;
                }

                // [ê·œì¹™ 2] í•™ë…„ ì§„ë„ ê·¸ë£¹í™” (Grade Cohesion)
                // ê°™ì€ í•™ë…„ì˜ ë‹¤ë¥¸ ë°˜ë“¤ì´ ì´ ìš”ì¼ì— ìˆ˜ì—…ì´ ìˆëŠ”ì§€ í™•ì¸
                let sameGradeCountOnDay = 0;
                for (let c = 1; c <= 12; c++) { // ì„ì˜ì˜ ìµœëŒ€ ë°˜ ê°œìˆ˜
                    if (c === task.classNum) continue;
                    // í•´ë‹¹ ìš”ì¼, í•´ë‹¹ í•™ë…„, í•´ë‹¹ ì„ ìƒë‹˜ì˜ ìˆ˜ì—…ì´ ìˆëŠ”ì§€ ì²´í¬
                    for (let p of PERIODS) {
                         // í‚¤ ìƒì„± ê·œì¹™ ì£¼ì˜: ì—¬ê¸°ì„œëŠ” ìŠ¤ì¼€ì¤„ì„ ìˆœíšŒí•˜ëŠ”ê²Œ ë¹„íš¨ìœ¨ì ì´ë¯€ë¡œ ìƒëµí•˜ê±°ë‚˜
                         // ë³„ë„ì˜ ì¸ë±ì‹±ì´ í•„ìš”í•˜ë‚˜, ê°„ëµíˆ ë£¸/ì„ ìƒë‹˜ í‚¤ë¡œ ìœ ì¶”
                         const keyT = `T-${task.teacherId}-${day}-${p}`;
                         const existingEntry = currentSchedule[keyT];
                         if (existingEntry && existingEntry.grade === task.grade) {
                             sameGradeCountOnDay++;
                             break; // í•´ë‹¹ ë°˜ì´ ì´ ìš”ì¼ì— ì´ë¯¸ ìˆìœ¼ë©´ ì¹´ìš´íŠ¸
                         }
                    }
                }
                
                // ê°™ì€ í•™ë…„ ìˆ˜ì—…ì´ ìˆëŠ” ìš”ì¼ì— ë°°ì¹˜í•˜ë©´ +20ì  (ì§„ë„ ë§ì¶”ê¸° ìœ ë¦¬)
                if (sameGradeCountOnDay > 0) score += 20;

                // [ê·œì¹™ 3] ìš”ì¼ë³„ ê· í˜• (ë„ˆë¬´ í•œ ìš”ì¼ì— ëª°ë¦¬ì§€ ì•Šê²Œ)
                // (ìƒëµ ê°€ëŠ¥í•˜ë‚˜, êµ¬í˜„í•˜ë©´ ì¢‹ìŒ)

                return score;
            };

            const generateTimetable = async () => {
                // 1. ë°ì´í„° ê²€ì¦
                const validTeachers = teachers.filter(t => t.name && t.grade && t.hoursPerClass);
                if (validTeachers.length === 0) {
                    alert("ìµœì†Œí•œ í•œ ëª… ì´ìƒì˜ êµì‚¬ ì •ë³´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }

                setIsGenerating(true);
                setGenerationStatus('ë°ì´í„° ë¶„ì„ ì¤‘...');
                setLogMessage([]);
                
                await new Promise(r => setTimeout(r, 50)); // UI ë Œë”ë§ ì–‘ë³´

                // 2. Task ìƒì„±
                let tasks = [];
                validTeachers.forEach(t => {
                    const classArray = String(t.classes).split(',')
                        .map(s => s.trim())
                        .filter(s => s !== '' && !isNaN(s))
                        .map(Number)
                        .sort((a,b) => a-b);

                    classArray.forEach(c => {
                        for(let i=0; i<t.hoursPerClass; i++) {
                            tasks.push({
                                uid: `${t.id}-${c}-${i}`, // ê³ ìœ  ID
                                teacherId: t.id, 
                                teacherName: t.name, 
                                subject: t.subject,
                                grade: parseInt(t.grade), 
                                classNum: c, 
                                room: t.room, 
                                color: t.color,
                                // ìš°ì„ ìˆœìœ„: ë£¸ ì‚¬ìš© ê³¼ëª© > 6í•™ë…„ > ê¸°íƒ€ (ì¼ë°˜ì ì¸ í•™êµ ê·œì¹™)
                                priority: (t.room ? 200 : 0) + (t.grade === 6 ? 100 : 0) + (Math.random() * 10)
                            });
                        }
                    });
                });

                // ìš°ì„ ìˆœìœ„ ì •ë ¬ (ì–´ë ¤ìš´ ë°°ì •ë¶€í„°)
                tasks.sort((a, b) => b.priority - a.priority);

                let bestSchedule = null;
                let minConflicts = Infinity;
                let bestScore = -Infinity;

                // 3. ë°˜ë³µ ì‹œë„ (Retry Logic)
                const MAX_ATTEMPTS = 50; // ìŠ¤ì½”ì–´ë§ ë°©ì‹ì´ë¼ íšŸìˆ˜ë¥¼ ì¤„ì—¬ë„ í€„ë¦¬í‹°ê°€ ì¢‹ìŒ

                for (let attempt = 0; attempt < MAX_ATTEMPTS; attempt++) {
                    let tempSchedule = {};
                    let conflictCount = 0;
                    let currentTasks = [...tasks]; 
                    
                    // ë§¤ ì‹œë„ë§ˆë‹¤ íƒœìŠ¤í¬ ìˆœì„œë¥¼ ì•½ê°„ ì„ì–´ì¤Œ (Local Optima íƒˆì¶œ)
                    // ë‹¨, ì¤‘ìš”ë„ê°€ ë†’ì€ ê·¸ë£¹ ë‚´ì—ì„œë§Œ ì„ì´ë„ë¡
                    if (attempt > 0) {
                         currentTasks.sort((a, b) => (b.priority + Math.random() * 50) - (a.priority + Math.random() * 50));
                    }

                    for (let task of currentTasks) {
                        let bestSlot = null;
                        let maxScore = -Infinity;
                        let possibleSlots = [];

                        // ê°€ëŠ¥í•œ ëª¨ë“  ìŠ¬ë¡¯ íƒìƒ‰
                        DAYS.forEach((d, dIdx) => {
                            PERIODS.forEach(p => {
                                // A. ê¸°ë³¸ í•œê³„ ì²´í¬
                                const limits = gradeLimits[task.grade] || [6,6,6,6,6];
                                if (p > limits[dIdx]) return;
                                if (blockedSlots[`${task.grade}-${dIdx}-${p}`]) return;

                                const slot = { day: dIdx, period: p };

                                // B. Hard Constraint ì²´í¬
                                if (isSlotValid(slot, task, tempSchedule)) {
                                    possibleSlots.push(slot);
                                }
                            });
                        });

                        // ê°€ëŠ¥í•œ ìŠ¬ë¡¯ ì¤‘ ì ìˆ˜ê°€ ê°€ì¥ ë†’ì€ ìŠ¬ë¡¯ ì„ íƒ
                        if (possibleSlots.length > 0) {
                            // ë¬´ì‘ìœ„ì„±ì„ ì•½ê°„ ì„ì–´ì„œ ë‹¤ì–‘í•œ ì‹œë„ ìœ ë„
                            possibleSlots.forEach(slot => {
                                const score = calculateSlotScore(slot, task, tempSchedule);
                                // ë™ì ì¼ ê²½ìš° ëœë¤ ì„ íƒ
                                const noise = Math.random() * 5; 
                                if (score + noise > maxScore) {
                                    maxScore = score + noise;
                                    bestSlot = slot;
                                }
                            });
                        }

                        if (bestSlot) {
                            const { day, period } = bestSlot;
                            const entry = { ...task, day, period };
                            tempSchedule[`T-${task.teacherId}-${day}-${period}`] = entry;
                            tempSchedule[`C-${task.grade}-${task.classNum}-${day}-${period}`] = entry;
                            if (task.room) tempSchedule[`R-${task.room}-${day}-${period}`] = entry;
                        } else {
                            conflictCount++;
                        }
                    }

                    // ì´ë²ˆ ì‹œë„ì˜ í’ˆì§ˆ í‰ê°€
                    if (conflictCount < minConflicts) {
                        minConflicts = conflictCount;
                        bestSchedule = tempSchedule;
                        // ë¡œê·¸ ê¸°ë¡
                        setLogMessage(prev => [`ì‹œë„ ${attempt + 1}: ë¯¸ë°°ì • ${conflictCount}ê±´ (ê°±ì‹ )`].slice(-5));
                    }
                    
                    // ì™„ë²½í•œ ì‹œê°„í‘œë¥¼ ì°¾ìœ¼ë©´ ì¡°ê¸° ì¢…ë£Œ
                    if (conflictCount === 0) break;
                }

                setSchedule(bestSchedule);
                setGenerationStatus(minConflicts === 0 
                    ? 'âœ¨ ì™„ë²½í•œ ì‹œê°„í‘œ ìƒì„± ì„±ê³µ!' 
                    : `âš ï¸ ìƒì„± ì™„ë£Œ (ë¯¸ë°°ì • ìˆ˜ì—…: ${minConflicts}ê±´ - ì¡°ê±´ì„ ì™„í™”í•´ë³´ì„¸ìš”)`);
                setIsGenerating(false);
                setActiveTab('result');
            };

            // --- ë Œë”ë§ í—¬í¼ ---
            const getScheduleContent = (dayIdx, period, filterType, filterValue) => {
                if (!schedule) return null;
                const day = dayIdx; 
                let key;
                if (filterType === 'teacher') key = `T-${filterValue}-${day}-${period}`;
                else {
                    const [g, c] = filterValue.split('-');
                    key = `C-${g}-${c}-${day}-${period}`;
                }
                const data = schedule[key];
                if (!data) return null;

                return (
                    <div className={`p-1 rounded text-xs text-center h-full flex flex-col justify-center items-center ${data.color} shadow-sm transition-all hover:shadow-md cursor-pointer hover:scale-105`}>
                        {filterType === 'teacher' ? (
                            <>
                                <span className="font-bold text-gray-800">{data.grade}-{data.classNum}</span>
                                <span className="text-gray-600 scale-90">{data.room}</span>
                            </>
                        ) : (
                            <>
                                <span className="font-bold text-gray-800">{data.subject}</span>
                                <span className="text-gray-600 scale-90">{data.teacherName}</span>
                            </>
                        )}
                    </div>
                );
            };

            const uniqueTeachers = useMemo(() => {
                // ì¤‘ë³µ ì œê±° ë° ì •ë ¬
                const map = new Map();
                teachers.forEach(t => {
                    if(t.name) map.set(t.id, t);
                });
                return Array.from(map.values());
            }, [teachers]);

            const classList = useMemo(() => {
                let list = [];
                [3, 4, 5, 6].forEach(g => {
                    const maxClass = Math.max(...teachers.filter(t => t.grade == g).flatMap(t => { 
                        return String(t.classes).split(',')
                            .map(s => s.trim())
                            .filter(s => s !== '' && !isNaN(s))
                            .map(Number);
                    }), 0);
                    if (maxClass > 0) {
                        for(let c=1; c<=maxClass; c++) list.push(`${g}-${c}`);
                    }
                });
                return list;
            }, [teachers]);

            return (
                <div className="max-w-7xl mx-auto p-4 pb-20">
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div className="mb-4 md:mb-0">
                            <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                <i className="fas fa-calendar-check text-blue-600"></i>
                                2026í•™ë…„ë„ êµê³¼ì „ë‹´ ì‹œê°„í‘œ ìƒì„±ê¸°
                            </h1>
                            <p className="text-sm text-gray-500 mt-1">
                                ê³µê°• ìµœì†Œí™”, ì§„ë„ ë§ì¶¤, 1ì¼ 1ê³¼ëª© ì œí•œ ê·œì¹™ì´ ì ìš©ëœ ìŠ¤ë§ˆíŠ¸ ì•Œê³ ë¦¬ì¦˜
                            </p>
                        </div>
                        <button 
                            onClick={generateTimetable}
                            disabled={isGenerating}
                            className={`px-8 py-3 rounded-xl text-white font-bold shadow-lg transform transition-all active:scale-95 flex items-center gap-2
                                ${isGenerating ? 'bg-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700'}`}
                        >
                            {isGenerating ? <><i className="fas fa-spinner fa-spin"></i> ìƒì„± ì¤‘...</> : <><i className="fas fa-magic"></i> ì‹œê°„í‘œ ìƒì„±í•˜ê¸°</>}
                        </button>
                    </div>

                    {/* Tabs */}
                    <div className="flex mb-6 bg-white rounded-lg p-1 shadow-sm border border-gray-100 inline-flex">
                        <button 
                            className={`px-6 py-2 rounded-md transition-colors ${activeTab === 'settings' ? 'bg-blue-50 text-blue-600 font-bold' : 'text-gray-500 hover:bg-gray-50'}`}
                            onClick={() => setActiveTab('settings')}
                        >
                            <i className="fas fa-cog mr-2"></i>ê¸°ë³¸ ì„¤ì •
                        </button>
                        <button 
                            className={`px-6 py-2 rounded-md transition-colors ${activeTab === 'input' ? 'bg-blue-50 text-blue-600 font-bold' : 'text-gray-500 hover:bg-gray-50'}`}
                            onClick={() => setActiveTab('input')}
                        >
                            <i className="fas fa-user-edit mr-2"></i>êµì‚¬ ì…ë ¥
                        </button>
                        <button 
                            className={`px-6 py-2 rounded-md transition-colors ${activeTab === 'result' ? 'bg-blue-50 text-blue-600 font-bold' : 'text-gray-500 hover:bg-gray-50'}`}
                            onClick={() => setActiveTab('result')}
                        >
                            <i className="fas fa-table mr-2"></i>ê²°ê³¼ í™•ì¸
                        </button>
                    </div>

                    {/* Status Message */}
                    {generationStatus && (
                        <div className={`mb-6 p-4 rounded-lg border flex justify-between items-center ${generationStatus.includes('ì„±ê³µ') ? 'bg-green-50 border-green-200 text-green-800' : 'bg-orange-50 border-orange-200 text-orange-800'}`}>
                            <div>
                                <span className="font-bold mr-2">ìƒíƒœ:</span>
                                {generationStatus}
                            </div>
                            <div className="text-xs text-gray-500 hidden md:block">
                                {logMessage.map((msg, i) => <div key={i}>{msg}</div>)}
                            </div>
                        </div>
                    )}

                    {/* Content */}
                    {activeTab === 'settings' && (
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 animate-fade-in">
                            <h2 className="text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2">
                                <span className="bg-blue-100 text-blue-600 rounded-full w-6 h-6 flex items-center justify-center text-xs">1</span>
                                í•™ë…„ë³„/ìš”ì¼ë³„ ìˆ˜ì—… ê°€ëŠ¥ êµì‹œ (Max Period)
                            </h2>
                            <div className="mb-8 overflow-x-auto">
                                <div className="min-w-[500px]">
                                    <div className="grid grid-cols-6 gap-2 text-center text-sm font-bold text-gray-500 mb-2 bg-gray-50 p-2 rounded">
                                        <div>í•™ë…„</div>
                                        {DAYS.map(d => <div key={d}>{d}ìš”ì¼</div>)}
                                    </div>
                                    {[3, 4, 5, 6].map(g => (
                                        <div key={g} className="grid grid-cols-6 gap-2 mb-2 items-center p-2 hover:bg-gray-50 rounded transition-colors">
                                            <div className="font-bold text-center text-gray-700 bg-gray-100 rounded py-1">{g}í•™ë…„</div>
                                            {DAYS.map((d, dIdx) => (
                                                <div key={dIdx} className="flex justify-center">
                                                    <input 
                                                        type="number" 
                                                        value={gradeLimits[g][dIdx]}
                                                        onChange={(e) => handleGradeLimitChange(g, dIdx, e.target.value)}
                                                        className="edit-input w-full text-center font-medium"
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <h2 className="text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2">
                                <span className="bg-red-100 text-red-600 rounded-full w-6 h-6 flex items-center justify-center text-xs">2</span>
                                ì „ë‹´ ìˆ˜ì—… ë°°ì • ê¸ˆì§€ ì‹œê°„ (Block Time)
                            </h2>
                            <p className="text-sm text-gray-500 mb-4 bg-gray-50 p-3 rounded">
                                <i className="fas fa-info-circle mr-2 text-blue-500"></i>
                                í•´ë‹¹ í•™ë…„ì˜ íŠ¹ì • ìš”ì¼/êµì‹œë¥¼ í´ë¦­í•˜ì—¬ <span className="text-red-500 font-bold">ë¹¨ê°„ìƒ‰(ê¸ˆì§€)</span>ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”. 
                                (ì˜ˆ: ë™ì•„ë¦¬, í•™êµ í–‰ì‚¬ ë“±)
                            </p>
                            
                            <div className="flex gap-2 mb-4">
                                {[3, 4, 5, 6].map(g => (
                                    <button 
                                        key={g}
                                        onClick={() => setActiveBlockGrade(g)}
                                        className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${activeBlockGrade === g ? 'bg-gray-800 text-white shadow-md' : 'bg-white border border-gray-300 text-gray-600 hover:bg-gray-50'}`}
                                    >
                                        {g}í•™ë…„ ì„¤ì •
                                    </button>
                                ))}
                            </div>

                            <div className="border rounded-lg overflow-hidden max-w-2xl shadow-sm">
                                <div className="grid grid-cols-6 border-b text-center bg-gray-50 text-sm font-bold text-gray-600 divide-x">
                                    <div className="py-3">êµì‹œ</div>
                                    {DAYS.map(d => <div key={d} className="py-3">{d}</div>)}
                                </div>
                                <div className="divide-y">
                                    {PERIODS.map(p => (
                                        <div key={p} className="grid grid-cols-6 divide-x h-12">
                                            <div className="flex items-center justify-center bg-gray-50 text-sm font-bold text-gray-500">
                                                {p}êµì‹œ
                                            </div>
                                            {DAYS.map((d, dIdx) => {
                                                const isBlocked = blockedSlots[`${activeBlockGrade}-${dIdx}-${p}`];
                                                const isOverLimit = p > gradeLimits[activeBlockGrade][dIdx]; 
                                                
                                                if (isOverLimit) {
                                                    return (
                                                        <div key={dIdx} className="bg-gray-100 flex items-center justify-center text-xs text-gray-400 cursor-not-allowed" title="ìˆ˜ì—… ì‹œìˆ˜ ì´ˆê³¼">
                                                            <i className="fas fa-times"></i>
                                                        </div>
                                                    );
                                                }

                                                return (
                                                    <div 
                                                        key={dIdx} 
                                                        onClick={() => toggleBlockedSlot(activeBlockGrade, dIdx, p)}
                                                        className={`block-grid-cell flex items-center justify-center text-sm font-bold ${isBlocked ? 'blocked' : 'bg-white'}`}
                                                    >
                                                        {isBlocked ? 'ê¸ˆì§€' : ''}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'input' && (
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-lg font-bold text-gray-800">êµì‚¬ ì •ë³´ ì…ë ¥</h2>
                                <button onClick={addTeacher} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow transition-colors text-sm font-bold">
                                    <i className="fas fa-plus mr-2"></i>êµì‚¬ ì¶”ê°€
                                </button>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm text-left text-gray-500 border-collapse">
                                    <thead className="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                                        <tr>
                                            <th className="px-3 py-3 w-32">êµì‚¬ëª…</th>
                                            <th className="px-3 py-3 w-32">ê³¼ëª©</th>
                                            <th className="px-3 py-3 w-20">í•™ë…„</th>
                                            <th className="px-3 py-3">ë‹´ë‹¹ ë°˜ (ì‰¼í‘œ êµ¬ë¶„)</th>
                                            <th className="px-3 py-3 w-24">ë°˜ë‹¹ ì‹œìˆ˜</th>
                                            <th className="px-3 py-3 w-32">íŠ¹ë³„ì‹¤</th>
                                            <th className="px-3 py-3 w-24">ìƒ‰ìƒ</th>
                                            <th className="px-3 py-3 w-16 text-center">ì‚­ì œ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {teachers.map((t, idx) => (
                                            <tr key={t.id} className="border-b hover:bg-blue-50 transition-colors">
                                                <td className="px-2 py-2">
                                                    <input className="edit-input" value={t.name} onChange={(e) => handleTeacherChange(t.id, 'name', e.target.value)} placeholder="ì˜ˆ: í™ê¸¸ë™" />
                                                </td>
                                                <td className="px-2 py-2">
                                                    <input className="edit-input" value={t.subject} onChange={(e) => handleTeacherChange(t.id, 'subject', e.target.value)} placeholder="ì˜ˆ: ê³¼í•™" />
                                                </td>
                                                <td className="px-2 py-2">
                                                    <input type="number" className="edit-input" value={t.grade} onChange={(e) => handleTeacherChange(t.id, 'grade', e.target.value)} placeholder="6" />
                                                </td>
                                                <td className="px-2 py-2">
                                                    <input className="edit-input" value={t.classes} onChange={(e) => handleTeacherChange(t.id, 'classes', e.target.value)} placeholder="1, 2, 3" />
                                                </td>
                                                <td className="px-2 py-2">
                                                    <input type="number" className="edit-input" value={t.hoursPerClass} onChange={(e) => handleTeacherChange(t.id, 'hoursPerClass', e.target.value)} placeholder="3" />
                                                </td>
                                                <td className="px-2 py-2">
                                                    <input className="edit-input" value={t.room} onChange={(e) => handleTeacherChange(t.id, 'room', e.target.value)} placeholder="ê³¼í•™ì‹¤1" />
                                                </td>
                                                <td className="px-2 py-2">
                                                    <select className={`edit-input cursor-pointer font-bold ${t.color}`} value={t.color} onChange={(e) => handleTeacherChange(t.id, 'color', e.target.value)}>
                                                        {COLOR_OPTIONS.map(opt => <option key={opt.value} value={opt.value} className={opt.value}>{opt.label}</option>)}
                                                    </select>
                                                </td>
                                                <td className="px-2 py-2 text-center">
                                                    <button onClick={() => removeTeacher(t.id)} className="text-red-400 hover:text-red-600 transition-colors"><i className="fas fa-trash-alt"></i></button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-4 mt-4 bg-blue-50 text-center text-sm text-blue-700 rounded-lg border border-blue-100">
                                <i className="fas fa-lightbulb mr-2"></i>
                                <strong>íŒ:</strong> 'ê³¼í•™'ì´ë‚˜ 'ì‹¤ê³¼'ì²˜ëŸ¼ íŠ¹ë³„ì‹¤ì„ ì‚¬ìš©í•˜ëŠ” ê³¼ëª©ì„ ë¨¼ì € ì…ë ¥í•˜ë©´ ë°°ì •ì´ ë” ì›í™œí•©ë‹ˆë‹¤.
                            </div>
                        </div>
                    )}

                    {activeTab === 'result' && (
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <div className="flex justify-between items-center mb-6">
                                <div className="flex gap-4 items-center">
                                    <span className="font-bold text-gray-700">ë³´ê¸° ëª¨ë“œ:</span>
                                    <div className="flex bg-gray-100 rounded-lg p-1">
                                        <button className={`px-4 py-2 rounded-md text-sm transition-all ${viewMode === 'teacher' ? 'bg-white shadow text-blue-600 font-bold' : 'text-gray-500 hover:text-gray-700'}`} onClick={() => setViewMode('teacher')}>êµì‚¬ë³„</button>
                                        <button className={`px-4 py-2 rounded-md text-sm transition-all ${viewMode === 'class' ? 'bg-white shadow text-blue-600 font-bold' : 'text-gray-500 hover:text-gray-700'}`} onClick={() => setViewMode('class')}>í•™ê¸‰ë³„</button>
                                    </div>
                                </div>
                                <button onClick={() => window.print()} className="text-gray-500 hover:text-gray-800 text-sm">
                                    <i className="fas fa-print mr-1"></i> ì¸ì‡„í•˜ê¸°
                                </button>
                            </div>

                            {uniqueTeachers.length === 0 ? (
                                <div className="text-center py-20 bg-gray-50 rounded-xl border border-dashed border-gray-300">
                                    <div className="text-4xl mb-4">ğŸ“</div>
                                    <p className="mb-2 text-lg font-bold text-gray-700">ì•„ì§ ìƒì„±ëœ ì‹œê°„í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                    <p className="text-sm text-gray-500">[êµì‚¬ ì…ë ¥] íƒ­ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ìƒë‹¨ì˜ [ì‹œê°„í‘œ ìƒì„±í•˜ê¸°] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                                </div>
                            ) : (
                                <div className="grid gap-10">
                                    {(viewMode === 'teacher' ? uniqueTeachers : classList).map(target => {
                                        const targetName = viewMode === 'teacher' ? target.id : target; // teacher object or class string
                                        const displayName = viewMode === 'teacher' ? `${target.name} ì„ ìƒë‹˜ (${target.subject})` : `${target}ë°˜`;
                                        
                                        return (
                                            <div key={viewMode === 'teacher' ? target.id : target} className="border rounded-xl overflow-hidden shadow-sm break-inside-avoid">
                                                <div className="bg-gradient-to-r from-gray-50 to-white px-6 py-3 font-bold text-gray-700 border-b flex justify-between items-center">
                                                    <span className="flex items-center gap-2">
                                                        <span className="w-2 h-6 bg-blue-500 rounded-full"></span>
                                                        {displayName}
                                                    </span>
                                                </div>
                                                <div className="grid grid-cols-6 border-b text-center bg-gray-50 text-xs font-bold text-gray-500 divide-x">
                                                    <div className="py-2">êµì‹œ</div>
                                                    {DAYS.map(d => <div key={d} className="py-2">{d}</div>)}
                                                </div>
                                                <div className="divide-y">
                                                    {PERIODS.map(p => (
                                                        <div key={p} className="grid grid-cols-6 divide-x h-20">
                                                            <div className="flex items-center justify-center bg-gray-50 text-xs font-bold text-gray-400 border-r">{p}êµì‹œ</div>
                                                            {DAYS.map((d, dIdx) => (
                                                                <div key={dIdx} className="p-1 relative">
                                                                    {getScheduleContent(dIdx, p, viewMode, targetName)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
